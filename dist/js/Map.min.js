function initialize(){function e(e){var t=e?"Error: Não aceitaram a permissão para pegar a localização":"Seu browser não suporta geolocalização.";map.setCenter(new google.maps.LatLng(-22.931827,-43.239654)),r.showError(!0),r.textError(t)}var t={zoom:18,disableDefaultUI:!0,scaleControl:!0,mapTypeId:google.maps.MapTypeId.ROADMAP},n=document.getElementById("field-search");map=new google.maps.Map(document.getElementById("map"),t),infowindow=new google.maps.InfoWindow,searchBox=new google.maps.places.SearchBox(n),map.controls[google.maps.ControlPosition.TOP_LEFT].push(n),navigator.geolocation?navigator.geolocation.getCurrentPosition(function(e){var t={lat:e.coords.latitude,lng:e.coords.longitude};map.setCenter(t),r.makeRequestFourSquare(),r.showHowManyPlaces(!0),setTimeout(function(){r.showHowManyPlaces(!1)},3100)},function(){e(!0),r.makeRequestFourSquare(),r.showHowManyPlaces(!0),setTimeout(function(){r.showHowManyPlaces(!1)},3100)}):e(!1),map.addListener("bounds_changed",function(){searchBox.setBounds(map.getBounds())}),google.maps.event.addDomListener(window,"resize",function(){r.fitBoundsMap()}),searchBox.addListener("places_changed",function(){var e=searchBox.getPlaces();r.postLocation(e["0"].formatted_address)});var r=new ViewModel;ko.applyBindings(r,$("#containerMaster")[0])}function errorGoogleApi(){var e=new ErrorGoogleMaps;ko.applyBindings(e,$("#messageError")[0])}var map,infowindow,searchBox,FourSquareLocal=function(e){var t=this;t.marker=new google.maps.Marker({position:{lat:e.venue.location.lat,lng:e.venue.location.lng},icon:e.venue.categories[0].icon.prefix+"bg_44"+e.venue.categories[0].icon.suffix,animation:google.maps.Animation.DROP,title:e.venue.name,selected:ko.observable(!1)}),t.placeName=e.venue.name||"Sem Informação",t.placeContact=e.venue.contact.formattedPhone||"Sem Informação",t.placeAddress=e.venue.location.formattedAddress[0]||"Sem Informação",t.placeCategories=e.venue.categories[0].name||"Sem Informação",t.placeRating=e.venue.rating||"Sem Informação";var n='<ul class="infoWindow__list">';n+='<li class="infoWindow__name">'+t.placeName+"</li>",n+='<li class="infoWindow__name">'+t.placeContact+"</li>",n+='<li class="infoWindow__name">'+t.placeAddress+"</li>",n+='<li class="infoWindow__name">'+t.placeCategories+"</li>",n+='<li class="infoWindow__name">'+t.placeRating+"</li>",n+="</ul>",t.addInfoWindow=function(){google.maps.event.addListener(t.marker,"click",function(){infowindow.setContent(n),infowindow.open(map,t.marker),t.marker.selected(!0),t.addAnimationSelect()}),google.maps.event.addListener(infowindow,"closeclick",function(){t.decreaseZoom()})},t.selectMarkerClickFilter=function(){infowindow.setContent(n),t.addAnimationSelect(),infowindow.open(map,t.marker)},t.addMarkers=function(){t.marker.setMap(map)},t.removeMarkers=function(){t.marker.setMap(null)},t.showMarker=function(){t.marker.setVisible(!0)},t.hideMarker=function(){t.marker.setVisible(!1)},t.addAnimationSelect=function(){t.marker.selected(!0)&&(t.marker.setAnimation(google.maps.Animation.BOUNCE),map.setZoom(18),map.panTo(t.marker.getPosition()),setTimeout(function(){t.marker.setAnimation(null),t.marker.selected(!1)},1400))},t.decreaseZoom=function(){map.setZoom(16)}},ViewModel=function(){var e=this;e.fourSquareAllLocals=ko.observableArray(),e.currentFilter=ko.observable(),e.showLoading=ko.observable(!0),e.showHowManyPlaces=ko.observable(),e.clearFilter=ko.observable(!1),e.showError=ko.observable(!1),e.textError=ko.observable(),e.showAside=ko.observable(!1),e.textShowAside=ko.observable(!1),e.classShowAside=ko.observable(!1);var t=new google.maps.LatLngBounds,n=new google.maps.Geocoder;e.postLocation=function(t){e.searchLocal(n,map,t)},e.searchLocal=function(t,n,r){e.showLoading(!0),e.showError(!1),e.textError(""),t.geocode({address:r},function(t,r){r===google.maps.GeocoderStatus.OK?(n.setCenter(t[0].geometry.location),n.setZoom(14),e.removeAllMarkes(),e.makeRequestFourSquare()):(e.showLoading(!1),e.showError(!0),e.textError("Geocode não teve sucesso pelo seguinte motivo: "+r))})},e.removeAllMarkes=function(){for(var t=0,n=e.fourSquareAllLocals().length;n>t;t++)e.fourSquareAllLocals()[t].removeMarkers();e.fourSquareAllLocals.removeAll()},e.makeRequestFourSquare=function(){var n=map.getCenter().toUrlValue(),r="https://api.foursquare.com/v2/venues/explore?";r+=$.param({client_id:"Y0KMJ2SSNWWUUYNWAFQ04EJAHGK3XJYJMLHCNVCJ4PVT5CEM",client_secret:"S4L0M0BTPHPMC0LY2R5JS22RIASITWR0VRV1LMKGP44HIM2O",v:"20160328",radius:"1000",limit:"15"}),r+="&ll="+n,$.getJSON(r,function(n){for(var r=n.response.groups[0].items,o=0,i=r.length;i>o;o++){e.currentFilter(null);var a=new FourSquareLocal(r[o]);a.addMarkers(),a.addInfoWindow(),e.fourSquareAllLocals.push(a),t.extend(a.marker.position)}e.fitBoundsMap(),e.showError(!1),e.textError(""),e.showLoading(!1)}).fail(function(t,n){e.showLoading(!1),e.showError(!0),e.textError("deu ruim na solicitação de dados para o foursquare pelo seguinte motivo: "+n)})},e.fitBoundsMap=function(){map.fitBounds(t)},e.justCategories=ko.computed(function(){var t=ko.utils.arrayMap(e.fourSquareAllLocals(),function(e){return e.placeCategories});return void 0===e.currentFilter()||null===e.currentFilter()||""===e.currentFilter()?(e.clearFilter(!1),t):ko.utils.arrayFilter(e.justCategories(),function(t){return t==e.currentFilter()})}),e.uniqueCategories=ko.computed(function(){return ko.utils.arrayGetDistinctValues(e.justCategories()).sort()}),e.filterCategories=ko.computed(function(){return void 0===e.currentFilter()||null===e.currentFilter()||""===e.currentFilter()?(e.clearFilter(!1),e.fourSquareAllLocals()):ko.utils.arrayFilter(e.fourSquareAllLocals(),function(t){return e.clearFilter(!0),t.placeCategories!==e.currentFilter()?t.hideMarker():t.showMarker(),t.placeCategories==e.currentFilter()})}),e.toggleAside=function(){var t=e.showAside(),n=e.textShowAside(),r=e.classShowAside();e.showAside(!t),e.textShowAside(!n),e.classShowAside(!r)},e.filter=function(t){e.currentFilter(t)},e.clearFilterAction=function(){e.currentFilter(""),e.fourSquareAllLocals().forEach(function(e){e.showMarker()})},e.numberOfPlaces=ko.pureComputed(function(){return e.fourSquareAllLocals().length})},ErrorGoogleMaps=function(){var e=this;e.showErrorLoadMaps=ko.observable(!0),e.textErrorLoadMaps=ko.observable("Tivemos algum problema para carregar o google maps... Por favor, verifique a sua conexão.")};